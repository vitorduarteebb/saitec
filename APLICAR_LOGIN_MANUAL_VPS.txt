# ============================================
# APLICAR FUNCIONALIDADE DE LOGIN MANUAL NA VPS
# ============================================

# ‚úÖ C√≥digo commitado e enviado para GitHub
# Nova funcionalidade: Bot√£o "Atualizar com Login Manual"

# ============================================
# COMANDOS PARA EXECUTAR NA VPS
# ============================================

# 1. Conectar na VPS
ssh root@72.62.9.29

# 2. Ir para o diret√≥rio do projeto
cd /root/saitec-automation

# 3. Parar processos travados
pm2 delete all

# 4. Atualizar c√≥digo do GitHub
git pull origin main

# Verificar se atualizou:
git log --oneline -3
# Deve mostrar: "Feat: Adicionar bot√£o 'Atualizar com Login Manual'..."

# 5. Verificar se arquivos foram atualizados
ls -la public/panel.html
grep -n "Atualizar com Login Manual" public/panel.html

# Deve mostrar a linha com o novo bot√£o

# 6. Reiniciar servidor
pm2 start server.js --name saitec-automation --update-env
pm2 save

# 7. Verificar se servidor est√° rodando
pm2 status
curl http://localhost:3000/health

# ============================================
# COMO USAR A NOVA FUNCIONALIDADE
# ============================================

# 1. Acessar o painel:
# http://72.62.9.29:3000/painel

# 2. Voc√™ ver√° DOIS bot√µes:
#    - üîÑ Atualizar (modo normal, headless)
#    - üîê Atualizar com Login Manual (abre navegador vis√≠vel)

# 3. Ao clicar em "üîê Atualizar com Login Manual":
#    - O sistema for√ßa KALODATA_HEADLESS=false temporariamente
#    - Abre navegador vis√≠vel na VPS
#    - Aguarda at√© 5 minutos para login manual
#    - Ap√≥s login, coleta continua automaticamente
#    - Cookies s√£o salvos para pr√≥ximas vezes

# ============================================
# IMPORTANTE: ACESSO AO NAVEGADOR NA VPS
# ============================================

# Para ver o navegador aberto na VPS, voc√™ precisa de:
# 1. VNC Server instalado na VPS
# 2. OU SSH com X11 forwarding
# 3. OU acesso remoto √† VPS

# Se n√£o tiver acesso visual √† VPS:
# - O navegador abrir√° mas voc√™ n√£o ver√°
# - Mesmo assim, pode fazer login se tiver credenciais no .env
# - Ou aguardar que algu√©m com acesso fa√ßa login manualmente

# ============================================
# TESTAR A FUNCIONALIDADE
# ============================================

# 1. Acessar painel:
curl http://localhost:3000/painel

# 2. Testar endpoint com forceVisible:
curl "http://localhost:3000/shop/top-products?source=kalodata&limit=10&forceVisible=true"

# 3. Monitorar logs:
pm2 logs saitec-automation --lines 0

# Deve mostrar:
# [API] ‚ö†Ô∏è Modo login manual ativado (forceVisible=true)
# [Kalodata] üîê MODO LOGIN MANUAL ATIVADO
# [Kalodata] ‚ö†Ô∏è O navegador ser√° aberto na VPS...

# ============================================
# SE PRECISAR INSTALAR VNC NA VPS (OPCIONAL)
# ============================================

# Para ver o navegador visualmente:
apt update
apt install -y tigervnc-standalone-server tigervnc-common

# Criar senha VNC:
vncpasswd

# Iniciar servidor VNC:
vncserver :1 -geometry 1920x1080 -depth 24

# Conectar via cliente VNC:
# IP: 72.62.9.29:5901

# ============================================
# VERIFICAR SE FUNCIONOU
# ============================================

# Nos logs, deve aparecer:
# ‚úÖ [Kalodata] ‚úÖ Login bem-sucedido usando cookies salvos!
# ‚úÖ [Kalodata] ‚úÖ Coletados X produtos mais vendidos

# No painel, deve mostrar produtos ap√≥s login manual

